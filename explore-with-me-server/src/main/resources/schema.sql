DROP TABLE IF EXISTS USERS CASCADE;
DROP TABLE IF EXISTS CATEGORY CASCADE;
DROP TABLE IF EXISTS EVENT CASCADE;
DROP TABLE IF EXISTS COMPILATION CASCADE;
DROP TABLE IF EXISTS EVENT_REQUEST CASCADE;
DROP TABLE IF EXISTS COMPILATION_EVENTS CASCADE;
DROP TABLE IF EXISTS COMMENT CASCADE;

CREATE TABLE IF NOT EXISTS USERS(
    USER_ID    BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME  VARCHAR(255)                            NOT NULL,
    EMAIL VARCHAR(512),
    CONSTRAINT PK_USER PRIMARY KEY (USER_ID),
    CONSTRAINT UQ_USER_EMAIL UNIQUE (EMAIL)
);

CREATE TABLE IF NOT EXISTS CATEGORY(
    CATEGORY_ID    BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME  VARCHAR(255) NOT NULL,
    CONSTRAINT PK_CATEGORY PRIMARY KEY (CATEGORY_ID)
);

CREATE TABLE IF NOT EXISTS EVENT(
    EVENT_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    ANNOTATION  TEXT,
    CATEGORY INT,
    CREATED_ON TIMESTAMP WITHOUT TIME ZONE,
    DESCRIPTION TEXT,
    EVENT_DATE TIMESTAMP WITHOUT TIME ZONE,
    INITIATOR BIGINT,
    LOCATION_LAT FLOAT,
    LOCATION_LON FLOAT,
    PAID BOOLEAN,
    PARTICIPANT_LIMIT INT,
    PUBLISHED_ON TIMESTAMP WITHOUT TIME ZONE,
    REQUEST_MODERATION BOOLEAN,
    STATE VARCHAR(50),
    TITLE TEXT,
    AVAILABLE BOOLEAN,
    CONSTRAINT PK_EVENT PRIMARY KEY (EVENT_ID)
);

CREATE TABLE IF NOT EXISTS EVENT_REQUEST(
    EVENT_REQUEST_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    ANNOTATION  TEXT,
    CREATED TIMESTAMP WITHOUT TIME ZONE,
    EVENT_ID BIGINT,
    USER_ID BIGINT,
    STATE VARCHAR(50),
    CONSTRAINT PK_EVENT_REQUEST PRIMARY KEY (EVENT_REQUEST_ID),
    CONSTRAINT FK_EVENT_REQUEST_EVENT FOREIGN KEY (EVENT_ID) REFERENCES EVENT(EVENT_ID),
    CONSTRAINT FK_EVENT_REQUEST_USER FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID)
);

CREATE TABLE IF NOT EXISTS COMPILATION(
    COMPILATION_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    PINNED BOOLEAN,
    TITLE TEXT,
    CONSTRAINT PK_COMPILATION PRIMARY KEY (COMPILATION_ID)
);

CREATE TABLE IF NOT EXISTS COMPILATION_EVENTS (
    COMPILATION_COMPILATION_ID BIGINT NOT NULL,
    EVENTS_EVENT_ID BIGINT NOT NULL,
    CONSTRAINT FK_COMPILATION_EVENT_ID FOREIGN KEY (EVENTS_EVENT_ID) REFERENCES EVENT,
    CONSTRAINT FK_COMPILATION_COMPILATION_ID FOREIGN KEY (COMPILATION_COMPILATION_ID) REFERENCES COMPILATION
);

CREATE TABLE IF NOT EXISTS COMMENT (
    COMMENT_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    TEXT TEXT NOT NULL,
    CREATED TIMESTAMP WITHOUT TIME ZONE,
    EVENT_ID BIGINT NOT NULL,
    USER_ID BIGINT NOT NULL,
    STATUS VARCHAR(50) NOT NULL,
    CONSTRAINT FK_EVENT_COMMENT FOREIGN KEY (EVENT_ID) REFERENCES EVENT(EVENT_ID),
    CONSTRAINT FK_USER_COMMENT FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID)
);
